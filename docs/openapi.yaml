openapi: 3.0.3
info:
  title: HB-RF-ETH API
  description: |
    REST API for HB-RF-ETH firmware v2.0 - Homematic RF-to-Ethernet bridge

    This API provides endpoints for device configuration, monitoring, and firmware management.

    ## Authentication
    All endpoints except `/login.json` require authentication using a bearer token.
    Obtain a token by posting credentials to `/login.json`.

    ## Security Note
    The default password is `admin`. **Change this immediately after first login.**

  version: 2.0.0
  contact:
    name: HB-RF-ETH Project
    url: https://github.com/Xerolux/HB-RF-ETH-ng
  license:
    name: CC BY-NC-SA 4.0
    url: https://creativecommons.org/licenses/by-nc-sa/4.0/

servers:
  - url: http://{deviceIP}
    description: Device HTTP server
    variables:
      deviceIP:
        default: 192.168.1.100
        description: IP address of the HB-RF-ETH device

tags:
  - name: Authentication
    description: Login and authentication endpoints
  - name: System
    description: System information and control
  - name: Settings
    description: Device configuration management
  - name: Monitoring
    description: SNMP and CheckMK monitoring configuration
  - name: Firmware
    description: Firmware update management

security:
  - TokenAuth: []

paths:
  /login.json:
    post:
      tags:
        - Authentication
      summary: Authenticate and obtain token
      description: Login with admin password to obtain an access token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: admin
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  isAuthenticated:
                    type: boolean
                    example: true
                  token:
                    type: string
                    example: a1b2c3d4e5f6...
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  isAuthenticated:
                    type: boolean
                    example: false

  /sysinfo.json:
    get:
      tags:
        - System
      summary: Get system information
      description: Retrieve device information including firmware version, hardware details, and radio module info
      responses:
        '200':
          description: System information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  sysInfo:
                    $ref: '#/components/schemas/SystemInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /settings.json:
    get:
      tags:
        - Settings
      summary: Get device settings
      description: Retrieve current device configuration
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/Settings'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Settings
      summary: Update device settings
      description: Update device configuration. All fields are optional.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Settings'
      responses:
        '200':
          description: Settings updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  settings:
                    $ref: '#/components/schemas/Settings'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/monitoring:
    get:
      tags:
        - Monitoring
      summary: Get monitoring configuration
      description: Retrieve SNMP and CheckMK monitoring configuration
      responses:
        '200':
          description: Monitoring configuration retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonitoringConfig'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Monitoring
      summary: Update monitoring configuration
      description: Update SNMP and CheckMK monitoring settings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MonitoringConfig'
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /ota_update:
    post:
      tags:
        - Firmware
      summary: Upload firmware update
      description: Upload and install a firmware update. Device must be manually restarted after upload.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Firmware binary file
      responses:
        '200':
          description: Firmware uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/restart:
    post:
      tags:
        - System
      summary: Restart device
      description: Restart the device immediately. HTTP connection will be closed.
      responses:
        '200':
          description: Device restarting
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: restarting
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    TokenAuth:
      type: apiKey
      in: header
      name: Authorization
      description: 'Token authentication. Format: "Token YOUR_TOKEN_HERE"'

  schemas:
    SystemInfo:
      type: object
      properties:
        serial:
          type: string
          description: Device serial number
          example: HB-RF-ETH-ABC123
        currentVersion:
          type: string
          description: Currently installed firmware version
          example: 2.0.0
        latestVersion:
          type: string
          description: Latest available firmware version
          example: 2.1.0
        rawUartRemoteAddress:
          type: string
          description: Remote address for raw UART connection
          example: 192.168.1.50:2000
        memoryUsage:
          type: number
          format: float
          description: Memory usage percentage
          example: 5.8
        cpuUsage:
          type: number
          format: float
          description: CPU usage percentage
          example: 12.5
        radioModuleType:
          type: string
          description: Type of radio module
          enum:
            - RPI-RF-MOD
            - HM-MOD-RPI-PCB
            - '-'
          example: RPI-RF-MOD
        radioModuleSerial:
          type: string
          description: Radio module serial number
          example: SGXXXXXX
        radioModuleBidCosRadioMAC:
          type: string
          description: BidCos radio MAC address
          example: '0xABCDEF'
        radioModuleHmIPRadioMAC:
          type: string
          description: HmIP radio MAC address
          example: '0x123456'
        radioModuleSGTIN:
          type: string
          description: Radio module SGTIN
          example: '3014F711A000000000XXXXXX'

    Settings:
      type: object
      properties:
        hostname:
          type: string
          description: Device hostname (max 63 chars, alphanumeric + hyphen + dot)
          maxLength: 63
          pattern: '^[a-zA-Z0-9][a-zA-Z0-9.-]*$'
          example: HB-RF-ETH-001
        useDHCP:
          type: boolean
          description: Enable DHCP for network configuration
          example: true
        localIP:
          type: string
          format: ipv4
          description: Static IP address (used when DHCP is disabled)
          example: 192.168.1.100
        netmask:
          type: string
          format: ipv4
          description: Network mask (used when DHCP is disabled)
          example: 255.255.255.0
        gateway:
          type: string
          format: ipv4
          description: Default gateway (used when DHCP is disabled)
          example: 192.168.1.1
        dns1:
          type: string
          format: ipv4
          description: Primary DNS server
          example: 8.8.8.8
        dns2:
          type: string
          format: ipv4
          description: Secondary DNS server
          example: 8.8.4.4
        timesource:
          type: integer
          description: Time source selection
          enum: [0, 1, 2]
          example: 0
          x-enum-descriptions:
            - 0 = NTP
            - 1 = DCF77
            - 2 = GPS
        dcfOffset:
          type: integer
          description: DCF77 signal offset in microseconds
          minimum: -60000
          maximum: 60000
          example: 40000
        gpsBaudrate:
          type: integer
          description: GPS module baud rate
          enum: [4800, 9600, 19200, 38400, 57600, 115200]
          example: 9600
        ntpServer:
          type: string
          description: NTP server hostname or IP address
          maxLength: 64
          example: pool.ntp.org
        ledBrightness:
          type: integer
          description: LED brightness percentage
          minimum: 0
          maximum: 100
          example: 100

    MonitoringConfig:
      type: object
      properties:
        snmp:
          type: object
          description: SNMP agent configuration
          properties:
            enabled:
              type: boolean
              description: Enable SNMP agent
              example: false
            community:
              type: string
              description: SNMP community string
              example: public
            location:
              type: string
              description: SNMP system location
              example: Server Room
            contact:
              type: string
              description: SNMP system contact
              example: admin@example.com
            port:
              type: integer
              description: SNMP agent port
              minimum: 1
              maximum: 65535
              example: 161
        checkmk:
          type: object
          description: CheckMK agent configuration
          properties:
            enabled:
              type: boolean
              description: Enable CheckMK agent
              example: false
            port:
              type: integer
              description: CheckMK agent port
              minimum: 1
              maximum: 65535
              example: 6556
            allowedHosts:
              type: string
              description: Comma-separated list of allowed IP addresses/ranges
              example: 192.168.1.0/24,10.0.0.5

  responses:
    Unauthorized:
      description: Unauthorized - invalid or missing authentication token
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Unauthorized

    BadRequest:
      description: Bad request - invalid input data
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Invalid request

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
                example: Internal server error
